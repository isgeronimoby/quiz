<%@ Control Language="C#" AutoEventWireup="true" CodeBehind="CustomisableControl.ascx.cs" Inherits="Rippleffect.Everton.PresentationLayer.Layout.Sublayouts.Module.CustomisableControl" %>

<!-- jQuery is required for popup to work -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300' rel='stylesheet' type='text/css'>
	<style type="text/css" rel="stylesheet">
		.everton-popup .everton-popup-clearfix:before,
		.everton-popup .everton-popup-clearfix:after {
			content:"";
			display:table;
		}
		.everton-popup .everton-popup-clearfix:after {
			clear:both;
		}
		.everton-popup .everton-popup-clearfix {
			zoom:1; /* For IE 6/7 (trigger hasLayout) */
		}
		/* END OF RESET */

		.everton-popup-block {
			display: none;
		}

		.everton-popup {
			display: none;
			position:fixed;
			top: 0; right: 0; bottom: 0; left: 0;
			z-index: 2;
			text-align: center;
			white-space: nowrap;
			cursor: pointer;
			background: #333;
			background: rgba(0, 0, 0, 0);
		}
		.everton-popup:last-of-type {
			background: rgba(0, 0, 0, 0.8);
		}
		.overthrow-enabled .overthrow {
			overflow: auto;
			-webkit-overflow-scrolling: touch;
		}
		.everton-popup:before {
			content: '';
			display: inline-block;
			vertical-align: middle;
			margin-right: -0.25em;
		}
		.everton-popup .everton-popup-content {
			position: relative;
			text-align: left;
			vertical-align: middle;
			display: inline-block;
			overflow: auto;
			border-bottom: 25px solid transparent;
			min-width:  30%;
			max-width: 650px;
			margin-left: 5%;
			margin-right: 5%;
			margin-top: 70px;
			max-height: 95%;
			background: #fff;
			cursor: auto;
			white-space: normal;
		}
		.everton-popup .everton-popup-inner {
			display: inline-block;
		}
		.everton-popup .everton-popup-close-icon {
			position: absolute;
			z-index: 9999;
			top: 0;
			right: 0;
			line-height: 30px;
			width: 30px;
			margin-right: 10px;
			margin-top: 4px;
			cursor: pointer;
			text-align: center;
			font: Arial, sans-serif;
			color: #ffffff;
		}
		.everton-popup-iframe .everton-popup-content {
			border-bottom: 0;
			padding: 0;
		}
		.everton-popup iframe {
			border: none;
		}

		.everton-popup .everton-popup-header {
			background-color: #00369c;
			height: 40px;
			/*width: 100%;*/
		}
		.everton-popup .everton-popup-header h1 {
			float: left;
			font-size: 18px;
			line-height: 40px;
			color: #fff;
			margin: 0;
			padding: 0;
			font-weight: 200;
			margin-left: 15px;
			font-family: Roboto,sans-serif;
		}
		.everton-popup .everton-popup-body {
			padding: 5px 24px 0 30px;
		}
		.everton-popup .everton-popup-body h2 {
			margin-top: 40px;
			margin-bottom: 40px;
			color: #00369c;
			text-align: center;
			font-size: 34px;
			font-weight: 700;
			line-height: 1.1;
		}
		.everton-popup .everton-popup-body h3 {
			color: #22479d;
			font-size: 24px;
			font-family: 'Roboto Condensed', Roboto,sans-serif;
			font-weight: 400;
			line-height: 26px;
			text-align: center;
		}
		.everton-popup .everton-popup-body .text-center {
			/*width: 100%;*/
			text-align: center;
		}
		.everton-popup .everton-popup-body .text-center img.phoneImage {
			display: inline-block;
			max-width: 180px;
			margin-right: -30px;
		}
		.everton-popup .everton-popup-body .everton-popup-yellow-btn {
			display: inline-block;
			padding: 20px 15px;
			margin-bottom: 40px;
			background-color: #ffd739;;
			font-family: Roboto,sans-serif;
			font-weight: 700;
			font-size: 28px;
			line-height: 32px;
			text-decoration: none;
			color: #000;
			text-align: center;
			border: 0;
			border-bottom: solid 4px #e4981f;
		}
		.everton-popup .everton-popup-body .everton-popup-btn-holder {
			text-align: center;
		}
		.everton-popup .everton-popup-body p {
			color: #444;
			margin: 10px 0 0;
			font-size: 16px;
			line-height: 20px;
		}
        .everton-popup .everton-popup-body .logos {
            margin-top: 15px;
            max-width: 560px;
            display: inline-block;
        }
		.everton-popup .everton-popup-body .everton-popup-btn-holder .not-ie,
		.everton-popup .everton-popup-body .everton-popup-btn-holder .ie-true{
			display: none;
		}
		.everton-popup .show-desktop {
			display: inherit;
		}
		.everton-popup .show-mobile {
			display: none;
		}
		/* RE Custom code */
		.text-center img {
			display: inline;
		}
		@media all and (max-width:1024px) {
			.everton-popup .show-desktop {
				display: none;
			}
			.everton-popup .show-mobile {
				display: inherit;
			}
			.everton-popup .everton-popup-body {
				padding: 0;
			}
			.everton-popup .everton-popup-body h3 {
				font-size: 20px;
				line-height: 24px;
				margin: 15px;
			}
			.everton-popup .everton-popup-body .everton-popup-yellow-btn {
				font-size: 18px;
				padding: 12px 14px;
				margin: 0 15px 24px;
			}
			.everton-popup .everton-popup-content {
				max-width: 85%;
				max-height: 85%;
			}
		}
		@media all and (max-width:420px) {
			.everton-popup .everton-popup-header h1 {
				font-size: 16px;
			}

			.everton-popup .everton-popup-body p {
				font-size: 14px;
			}
			.everton-popup .everton-popup-body h2 {
				font-size: 18px;
				line-height: 1.4;
				margin: 24px 15px 0;
			}
		}
		@media all and (max-width:600px) and (max-height:820px) {
			.everton-popup .everton-popup-inner {
				padding-bottom: 30px;
			}
		}
	</style>

<script>
	// IE function.bind polyfill
	if (!Function.prototype.bind) {
		Function.prototype.bind = function (oThis) {
			if (typeof this !== "function") {
				// closest thing possible to the ECMAScript 5 internal IsCallable function
				throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
			}

			var aArgs = Array.prototype.slice.call(arguments, 1),
					fToBind = this,
					fNOP = function () {},
					fBound = function () {
						return fToBind.apply(this instanceof fNOP && oThis ? this : oThis,
								aArgs.concat(Array.prototype.slice.call(arguments)));
					};

			fNOP.prototype = this.prototype;
			fBound.prototype = new fNOP();

			return fBound;
		};
	}
</script>
<script>
	if (/*@cc_on!@*/false && document.documentMode === 10) {
		document.documentElement.className += ' ie ie10';
	}
</script>

<!-- OVERTHROW - script for Android where overflow doesn't work -->
<script>
	/*! overthrow - An overflow:auto polyfill for responsive design. - v0.7.0 - 2013-11-04
	 * Copyright (c) 2013 Scott Jehl, Filament Group, Inc.; Licensed MIT */
	!function(a){var b=a.document,c=b.documentElement,d="overthrow-enabled",e="ontouchmove"in b,f="WebkitOverflowScrolling"in c.style||"msOverflowStyle"in c.style||!e&&a.screen.width>800||function(){var b=a.navigator.userAgent,c=b.match(/AppleWebKit\/([0-9]+)/),d=c&&c[1],e=c&&d>=534;return b.match(/Android ([0-9]+)/)&&RegExp.$1>=3&&e||b.match(/ Version\/([0-9]+)/)&&RegExp.$1>=0&&a.blackberry&&e||b.indexOf("PlayBook")>-1&&e&&-1===!b.indexOf("Android 2")||b.match(/Firefox\/([0-9]+)/)&&RegExp.$1>=4||b.match(/wOSBrowser\/([0-9]+)/)&&RegExp.$1>=233&&e||b.match(/NokiaBrowser\/([0-9\.]+)/)&&7.3===parseFloat(RegExp.$1)&&c&&d>=533}();a.overthrow={},a.overthrow.enabledClassName=d,a.overthrow.addClass=function(){-1===c.className.indexOf(a.overthrow.enabledClassName)&&(c.className+=" "+a.overthrow.enabledClassName)},a.overthrow.removeClass=function(){c.className=c.className.replace(a.overthrow.enabledClassName,"")},a.overthrow.set=function(){f&&a.overthrow.addClass()},a.overthrow.canBeFilledWithPoly=e,a.overthrow.forget=function(){a.overthrow.removeClass()},a.overthrow.support=f?"native":"none"}(this),function(a,b,c){if(b!==c){b.easing=function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},b.tossing=!1;var d;b.toss=function(a,e){b.intercept();var f,g,h=0,i=a.scrollLeft,j=a.scrollTop,k={top:"+0",left:"+0",duration:50,easing:b.easing,finished:function(){}},l=!1;if(e)for(var m in k)e[m]!==c&&(k[m]=e[m]);return"string"==typeof k.left?(k.left=parseFloat(k.left),f=k.left+i):(f=k.left,k.left=k.left-i),"string"==typeof k.top?(k.top=parseFloat(k.top),g=k.top+j):(g=k.top,k.top=k.top-j),b.tossing=!0,d=setInterval(function(){h++<k.duration?(a.scrollLeft=k.easing(h,i,k.left,k.duration),a.scrollTop=k.easing(h,j,k.top,k.duration)):(f!==a.scrollLeft?a.scrollLeft=f:(l&&k.finished(),l=!0),g!==a.scrollTop?a.scrollTop=g:(l&&k.finished(),l=!0),b.intercept())},1),{top:g,left:f,duration:b.duration,easing:b.easing}},b.intercept=function(){clearInterval(d),b.tossing=!1}}}(this,this.overthrow),function(a,b,c){if(b!==c){b.scrollIndicatorClassName="overthrow";var d=a.document,e=d.documentElement,f="native"===b.support,g=b.canBeFilledWithPoly,h=(b.configure,b.set),i=b.forget,j=b.scrollIndicatorClassName;b.closest=function(a,c){return!c&&a.className&&a.className.indexOf(j)>-1&&a||b.closest(a.parentNode)};var k=!1;b.set=function(){if(h(),!k&&!f&&g){a.overthrow.addClass(),k=!0,b.support="polyfilled",b.forget=function(){i(),k=!1,d.removeEventListener&&d.removeEventListener("touchstart",u,!1)};var j,l,m,n,o=[],p=[],q=function(){o=[],l=null},r=function(){p=[],m=null},s=function(a){n=j.querySelectorAll("textarea, input");for(var b=0,c=n.length;c>b;b++)n[b].style.pointerEvents=a},t=function(a,b){if(d.createEvent){var e,f=(!b||b===c)&&j.parentNode||j.touchchild||j;f!==j&&(e=d.createEvent("HTMLEvents"),e.initEvent("touchend",!0,!0),j.dispatchEvent(e),f.touchchild=j,j=f,f.dispatchEvent(a))}},u=function(a){if(b.intercept&&b.intercept(),q(),r(),j=b.closest(a.target),j&&j!==e&&!(a.touches.length>1)){s("none");var c=a,d=j.scrollTop,f=j.scrollLeft,g=j.offsetHeight,h=j.offsetWidth,i=a.touches[0].pageY,k=a.touches[0].pageX,n=j.scrollHeight,u=j.scrollWidth,v=function(a){var b=d+i-a.touches[0].pageY,e=f+k-a.touches[0].pageX,s=b>=(o.length?o[0]:0),v=e>=(p.length?p[0]:0);b>0&&n-g>b||e>0&&u-h>e?a.preventDefault():t(c),l&&s!==l&&q(),m&&v!==m&&r(),l=s,m=v,j.scrollTop=b,j.scrollLeft=e,o.unshift(b),p.unshift(e),o.length>3&&o.pop(),p.length>3&&p.pop()},w=function(){s("auto"),setTimeout(function(){s("none")},450),j.removeEventListener("touchmove",v,!1),j.removeEventListener("touchend",w,!1)};j.addEventListener("touchmove",v,!1),j.addEventListener("touchend",w,!1)}};d.addEventListener("touchstart",u,!1)}}}}(this,this.overthrow),function(a){a.overthrow.set()}(this);
</script>
<!-- Compressed FEATHERLIGHT script -->
<script>
	!function(e){"use strict";function t(e,n){if(!(this instanceof t)){var o=new t(e,n);return o.open(),o}this.id=t.id++,this.setup(e,n),this.chainCallbacks(t._callbackChain)}if("undefined"==typeof e)return void("console"in window&&window.console.info("Too much lightness, Featherlight needs jQuery."));var n=function(e){if(!e.isDefaultPrevented()){var n=t.current();n&&n.onKeyDown(e)}};t.prototype={constructor:t,namespace:"everton-popup",targetAttr:"data-featherlight",variant:null,resetCss:!1,background:null,openTrigger:"click",closeTrigger:"click",filter:null,root:"body",openSpeed:250,closeSpeed:250,closeOnClick:"background",closeOnEsc:!0,closeIcon:"&#10005;",otherClose:null,beforeOpen:e.noop,beforeContent:e.noop,beforeClose:e.noop,afterOpen:e.noop,afterContent:e.noop,afterClose:e.noop,onKeyDown:e.noop,type:null,contentFilters:["jquery","image","html","ajax","text"],setup:function(t,n){"object"!=typeof t||t instanceof e!=!1||n||(n=t,t=void 0);var o=e.extend(this,n,{target:t}),r=o.resetCss?o.namespace+"-reset":o.namespace,a=e(o.background||['<div class="'+r+'">','<div class="'+r+'-content overthrow">','<span class="'+r+"-close-icon "+o.namespace+'-close">',o.closeIcon,"</span>",'<div class="'+o.namespace+'-inner"></div>',"</div>","</div>"].join("")),i="."+o.namespace+"-close"+(o.otherClose?","+o.otherClose:"");return o.$instance=a.clone().addClass(o.variant),o.$instance.on(o.closeTrigger+"."+o.namespace,function(t){var n=e(t.target);("background"===o.closeOnClick&&n.is("."+o.namespace)||"anywhere"===o.closeOnClick||n.is(i))&&(t.preventDefault(),o.close())}),this},getContent:function(){var t=this,n=this.constructor.contentFilters,o=function(e){return t.$currentTarget&&t.$currentTarget.attr(e)},r=o(t.targetAttr),a=t.target||r||"",i=n[t.type];if(!i&&a in n&&(i=n[a],a=t.target&&r),a=a||o("href")||"",!i)for(var s in n)t[s]&&(i=n[s],a=t[s]);if(!i){var c=a;if(a=null,e.each(t.contentFilters,function(){return i=n[this],i.test&&(a=i.test(c)),!a&&i.regex&&c.match&&c.match(i.regex)&&(a=c),!a}),!a)return"console"in window&&window.console.error("Featherlight: no content filter found "+(c?' for "'+c+'"':" (no target specified)")),!1}return i.process.call(t,a)},setContent:function(t){var n=this;return(t.is("iframe")||e("iframe",t).length>0)&&n.$instance.addClass(n.namespace+"-iframe"),n.$content=t.addClass(n.namespace+"-inner"),n.$instance.find("."+n.namespace+"-inner").slice(1).remove().end().replaceWith(n.$content),n},open:function(o){var r=this;if(!(o&&o.isDefaultPrevented()||r.beforeOpen(o)===!1)){o&&o.preventDefault();var a=r.getContent();if(a)return r.constructor._opened.add(r._openedCallback=function(e,t){r instanceof e&&r.$instance.closest("body").length>0&&(t.currentFeatherlight=r)}),t._keyHandlerInstalled||(e(document).on("keyup."+t.prototype.namespace,n),t._keyHandlerInstalled=!0),r.$instance.appendTo(r.root).fadeIn(r.openSpeed),r.beforeContent(o),e.when(a).done(function(t){r.setContent(t),r.afterContent(o),e.when(r.$instance.promise()).done(function(){r.afterOpen(o)})}),r}return!1},close:function(o){var r=this;return r.beforeClose(o)===!1?!1:(r.constructor._opened.remove(r._openedCallback),t.current()||(e(document).off("keyup."+t.namespace,n),r.constructor._keyHandlerInstalled=!1),void r.$instance.fadeOut(r.closeSpeed,function(){r.$instance.detach(),r.afterClose(o)}))},chainCallbacks:function(t){for(var n in t)this[n]=e.proxy(t[n],this,e.proxy(this[n],this))}},e.extend(t,{id:0,autoBind:"[data-featherlight]",defaults:t.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(t){return t instanceof e&&t},process:function(t){return e(t).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff|bmp)(\?\S*)?$/i,process:function(t){var n=this,o=e.Deferred(),r=new Image;return r.onload=function(){o.resolve(e('<img src="'+t+'" alt="" class="'+n.namespace+'-image" />'))},r.onerror=function(){o.reject()},r.src=t,o.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(t){return e(t)}},ajax:{regex:/./,process:function(t){var n=e.Deferred(),o=e("<div></div>").load(t,function(e,t){"error"!==t&&n.resolve(o.contents()),n.fail()});return n.promise()}},text:{process:function(t){return e("<div>",{text:t})}}},functionAttributes:["beforeOpen","afterOpen","beforeContent","afterContent","beforeClose","afterClose"],readElementConfig:function(t){var n=this,o={};return t&&t.attributes&&e.each(t.attributes,function(){var t=this.name.match(/^data-featherlight-(.*)/);if(t){var r=this.value,a=e.camelCase(t[1]);if(e.inArray(a,n.functionAttributes)>=0)r=new Function(r);else try{r=e.parseJSON(r)}catch(i){}o[a]=r}}),o},extend:function(t,n){var o=function(){this.constructor=t};return o.prototype=this.prototype,t.prototype=new o,t.__super__=this.prototype,e.extend(t,this,n),t.defaults=t.prototype,t},attach:function(t,n,o){var r=this;"object"!=typeof n||n instanceof e!=!1||o||(o=n,n=void 0),o=e.extend({},o);var a=e.extend({},r.defaults,r.readElementConfig(t[0]),o);return t.on(a.openTrigger+"."+a.namespace,a.filter,function(a){var i=e.extend({$source:t,$currentTarget:e(this)},r.readElementConfig(t[0]),r.readElementConfig(this),o);new r(n,i).open(a)}),t},current:function(){var e={};return this._opened.fire(this,e),e.currentFeatherlight},close:function(){var e=this.current();e&&e.close()},_onReady:function(){var t=this;t.autoBind&&(t.attach(e(document),{filter:t.autoBind}),e(t.autoBind).filter("[data-featherlight-filter]").each(function(){t.attach(e(this))}))},_callbackChain:{onKeyDown:function(e,t){return 27===t.keyCode&&this.closeOnEsc?(this.$instance.find("."+this.namespace+"-close:first").click(),void t.preventDefault()):(console.log("pass"),e(t))}},_opened:e.Callbacks()}),e.featherlight=t,e.fn.featherlight=function(e,n){return t.attach(this,e,n)},e(document).ready(function(){t._onReady()})}(jQuery);
</script>
<script type="text/javascript">
	window.onload = function() {
		function GetIEVersion() {
			var sAgent = window.navigator.userAgent;
			var Idx = sAgent.indexOf("MSIE");

			// If IE, return version number.
			var ieTrue = document.getElementsByClassName("ie-true");
			var notIE = document.getElementsByClassName("not-ie");
			if (Idx > 0) {
				for (var i = 0; i < ieTrue.length; i++) {
					ieTrue[i].style.display = "inline-block";
				}
				return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf(".", Idx)));
			}

			// If IE 11 then look for Updated user agent string.
			else if (!!navigator.userAgent.match(/Trident\/7\./)) {
				for (var i = 0; i < ieTrue.length; i++) {
					ieTrue[i].style.display = "inline-block";
				}
			}

			else {
				for (var i = 0; i < notIE.length; i++) {
					notIE[i].style.display = "inline-block";
				}
				return 0; //It is not IE
			}
		}
		GetIEVersion();

		var redirectTimeout = 5000;
		var redirectUrl = "https://everton.rewarded.club";

		function redirectAfterInstall() {
			setTimeout(function () {
				window.top.location.href = redirectUrl;
			}, redirectTimeout);
		}

		(function () {
			var notIE = document.getElementsByClassName("not-ie");
			for (var i = 0; i < notIE.length; i++) {
				notIE[i].onclick = function (e) {
					if (!window.navigator.userAgent) return;

					var ua = window.navigator.userAgent.toLowerCase();
					if (ua.indexOf("iphone") > 0 || ua.indexOf("ipad") > 0)
						return;

					if (ua.indexOf("android") > 0)
						return;

					if (ua.indexOf("firefox") > 0 && ua.indexOf("seamonkey") < 0) {
						redirectAfterInstall();
						return;
					}

					if (ua.indexOf("safari") > 0 && ua.indexOf("chrome") < 0) {
						redirectAfterInstall();
						return;
					}

					if (ua.indexOf("chrome") > 0 && ua.indexOf("opr") < 0) {
						return;
					}
				}
			}
		})();

		//RE Custom code
		var cookieName = '__EvertonFCRewardsCookie__';
		function showPopupOnLoad() {
			$.featherlight('#everton-popup-onload').open();
		}

		function checkCookie() {
			var cookie = getCookie(cookieName);
			if (cookie == '') {
				setCookie(cookieName, cookieName, 10);
				showPopupOnLoad();
			}
		}

		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for (var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0) == ' ') c = c.substring(1);
				if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
			}
			return "";
		}

		function setCookie(cname, cvalue, exdays) {
			var d = new Date();
			d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
			var expires = "expires=" + d.toUTCString();
			document.cookie = cname + "=" + cvalue + "; " + expires;
		}
		checkCookie();
		//RE Custom code end
	}
</script>

<div id="everton-popup-onload" class="everton-popup-block">
	<div class="everton-popup-header">
		<h1 class="show-desktop">Free Official Everton Browser app</h1>
		<h1 class="show-mobile">Free Official Everton Browser</h1>
		<a href="#" class="everton-popup-close"></a>
		<div class="everton-popup-clearfix"></div>
	</div>
	<div class="everton-popup-body">
		<h3 class="show-desktop">Earn cashback on your online shopping,
			win the opportunity to meet the team and support EITC</h3>
		<h3 class="show-mobile">Earn cashback on your online shopping, win the opportunity to meet the team and support EITC</h3>
		<div class="everton-popup-btn-holder show-desktop">
			<a class="not-ie everton-popup-yellow-btn" href="https://everton.rewarded.club/home/install" target="_top">Install Everton Rewards</a>
			<a class="ie-true everton-popup-yellow-btn" href="https://everton.rewarded.club/home/install" target="_top">Try Everton Rewards</a>
		</div>
		<div class="everton-popup-btn-holder show-mobile">
			<a class="everton-popup-yellow-btn" href="https://everton.rewarded.club/home/install" target="_top">Install Everton Browser</a>
		</div>
		<div class="text-center show-mobile">
			<img class="phoneImage" src="./images/iphone_circle_zoom.png" />
		</div>
		<div class="text-center show-desktop">
			<img src="./images/retailers-everton-popup.png" />
		</div>
        <div class="text-center show-desktop">
            <img class="logos" src="./images/retailer-logos-everton.png" />
        </div>
	</div>
</div>