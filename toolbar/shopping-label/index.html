<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <link href="./css/main.css" type="text/css"/>
    <link href="./css/skin.css" type="text/css"/>

</head>
<body>

<div class="everton-shopping-label-trigger">
    <div class="everton-shopping-label">
        <div class="everton-shopping-label-logo"></div>
        <div class="everton-shopping-label-content">
            <div class="everton-shopping-label-ask">
                <div class="everton-shopping-label-heading">
                    Earn QPR credits on Argos?
                </div>
                <div class="everton-shopping-label-answer-btn">Great, let me ean credits</div>
                <div class="everton-shopping-label-p everton-shopping-label-no-btn">No, thanks</div>
            </div>
            <div class="everton-shopping-label-answer">
                <table>
                    <tr class="everton-shopping-label-message everton-shopping-label-message-yes">
                        <td colspan="3">You will be earning credits now</td>
                    </tr>
                    <tr class="everton-shopping-label-message everton-shopping-label-message-not">
                        <td colspan="3">You are not on one of our <a href="#partners">partner site</a></td>
                    </tr>
                    <tr class="everton-shopping-label-stats">
                        <td class="everton-shopping-stats-confirmed">
                            <a href="#confirmed">
                                <div class="everton-shopping-label-pounds">1000.00</div>
                                <div class="everton-shopping-label-stat-name">Confirmed</div>
                            </a>
                        </td>
                        <td class="everton-shopping-stats-pending">
                            <a href="#pending">
                                <div class="everton-shopping-label-pounds">1000.00</div>
                                <div class="everton-shopping-label-stat-name">Pending</div>
                            </a>
                        </td>
                        <td class="everton-shopping-stats-donated">
                            <a href="#donated">
                                <div class="everton-shopping-label-pounds">1000.00</div>
                                <div class="everton-shopping-label-stat-name">Donated</div>
                            </a>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="everton-shopping-label-close">&#215;</div>
        </div>
        <div class="everton-shopping-label-clearfix"></div>
        <div class="everton-shopping-label-bottom-text">
            <div class="everton-shopping-label-countdown">Closes in <span>10</span> secs</div>
            <a href="#faq" class="everton-shopping-label-info">i</a>
        </div>
    </div>
</div>

<script type="text/javascript">

    "use strict";

    var EvertonLabel = {
        'labelBody': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label'),

        // BUTTONS
        'btnYes': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-ask .everton-shopping-label-answer-btn'),
        'btnNo': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-ask .everton-shopping-label-no-btn'),
        'btnClose': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-close'),
        'btnInfo': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-info'),

        //SCREENS
        'screenAsk': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-ask'),
        'screenAnswer': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-answer'),
        'screenActive': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-answer .everton-shopping-label-message-yes'),
        'screenNot': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-answer .everton-shopping-label-message-not'),

        //OTHER
        'counterHolder': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-countdown'),
        'counter': document.querySelector('.everton-shopping-label-trigger > .everton-shopping-label ' +
        '.everton-shopping-label-countdown span'),
        'interval': '',
        'timeLeft': 10,

        //METHODS
        'showLabel': function(screen){
            var that = this;
            switch (screen){
                case 'yes':
                    that.screenAsk.style.display = 'none';
                    that.screenAnswer.style.display = 'block';
                    that.screenActive.style.display = 'table-row';
                    that.counterHolder.style.display = 'none';
                    break;
                case 'not':
                    that.screenAsk.style.display = 'none';
                    that.screenAnswer.style.display = 'block';
                    that.screenNot.style.display = 'table-row';
                    that.counterHolder.style.display = 'none';
                    break;
                default:
                /* Do nothing */
            }
            var wasInteraction = false;
            that.labelBody.style.display = 'block';
            that.labelBody.parentNode.style.display = 'block';
            setTimeout(function(){
                that.labelBody.className += ' everton-shopping-label-start-sliding';
                setTimeout(function(){
                    if ( screen != 'yes' && screen != 'not' ) {
                        that.runTimer();
                    }
                    that.changeZIndexes();
                }, 500)
            }, 30);
            document.body.className += ' noiframe';

            that.btnClose.addEventListener('click', function(){
                that.closeInit();
                that.hideLabel();
            });

            that.btnYes.addEventListener('click', function(){
                that.hideLabel();
                setTimeout(function(){
                    // wait for the end of animation
                    // then reload the page to enable tracking
                }, 500);
            });

            that.btnNo.addEventListener('click', function(){
                that.hideLabel();
            });

            that.btnInfo.addEventListener('click', function(){
                that.closeInit();
            });

            if ( screen != 'yes' && screen != 'not' ) {
                that.labelBody.addEventListener('mouseenter', function () {
                    if (!wasInteraction) {
                        that.stopTimer();
                        wasInteraction = true;
                    }
                });

                that.labelBody.addEventListener('mouseleave', function () {
                    if (wasInteraction) {
                        that.runTimer();
                        wasInteraction = false;
                    }
                });
            }
        },
        'hideLabel': function(){
            var that = this;
            that.labelBody.className = that.labelBody.className.replace(/\beverton-shopping-label-start-sliding\b/, '');
            that.stopTimer();
            setTimeout(function(){
                that.labelBody.style.display = 'none';
                that.labelBody.parentNode.style.display = 'none';
                document.body.className = document.body.className.replace(/\bnoiframe\b/, '');
            }, 500);
        },

        'closeInit': function(){
            var that = this;
            that.counterHolder.style.display = 'none';
            that.labelBody.addEventListener('mouseleave', function(){
                that.stopTimer();
            });
            that.stopTimer();
        },
        'runTimer': function(){
            var that = this;
            that.interval = setInterval(function(){
                that.counter.innerHTML = Math.round(that.timeLeft);
                that.timeLeft -= 0.1;
                if ( that.timeLeft <= 0 ) {
                    that.stopTimer();
                    that.hideLabel();
                }
            }, 100);
        },
        'stopTimer': function(){
            if (this.interval != '')
                clearInterval(this.interval);
        },
        'changeZIndexes': function(){
            var lrPopup = document.querySelector('.everton-shopping-label-trigger');
            var array = Array.prototype.slice.call(document.querySelectorAll('div'));
            var neededDivs = [];

            array.forEach(function(el){
                if ( +(window.getComputedStyle(el, null)['z-index']) > 999999 ) {
                    neededDivs.push(el);
                }
            });
            if ( neededDivs.length > 1 ) {
                neededDivs.forEach(function (el) {
                    el.style.cssText += ';z-index: 999999 !important;'
                });
                lrPopup.style.cssText += ';z-index: 9999999999 !important;'
            }
        }
    };

</script>

</body>
</html>